<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Blog</title>
    <link rel="stylesheet" href="app.css">
</head>

<body>
    <header>
        <h1>My Simple Blog</h1>
    </header>

    <main>
        <!-- Input Form -->
        <section class="new-post">
            <input type="text" id="postTitle" placeholder="Naam van de post" />
            <textarea id="postContent" placeholder="Text"></textarea>
            <button onclick="addPost()">Add Post</button>
        </section>

        <!-- Blog Posts -->
        <section id="posts">
        </section>
    </main>

    <script>
        const API = 'http://localhost:3000';

        const getEl = id => document.getElementById(id);

        async function getComments() {
            try {
                const res = await fetch(`${API}/get-comments`);
                const data = await res.json();
                displayComments(data.reverse());
            } catch (err) {
                alert("Failed to load comments.");
            }
        }

        function displayComments(comments) {
            const container = getEl('posts');
            container.innerHTML = comments.map(c => `
                <div class="post">
                <div class="meta"><strong>${c.author}</strong> â€” ${new Date(c.date).toLocaleString()}</div>
                <p>${c.text}</p>
                <button onclick="deleteComment(${c.id})">Delete</button>
                </div>
            `).join('');
        }

        async function addComment() {
            const author = getEl('author').value.trim();
            const text = getEl('text').value.trim();

            if (!author || !text) return alert("Please fill in both fields.");

            await fetch(`${API}/insert-comments`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ author, text })
            });

            getEl('author').value = '';
            getEl('text').value = '';
            fetchComments();
        }

        async function deleteComment(id) {
            await fetch(`${API}/delete-comments/${id}`, { method: 'DELETE' });
            fetchComments();
        }

        fetchComments();
    </script>
</body>

</html>