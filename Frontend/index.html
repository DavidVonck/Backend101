<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Blog</title>
    <link rel="stylesheet" href="app.css">
</head>

<body>
    <header>
        <h1>My Simple Blog</h1>
    </header>

    <main>
        <!-- Input Form -->
        <section class="new-post">
            <input type="text" id="Name" placeholder="Naam van de post" />
            <textarea id="Text" placeholder="Text"></textarea>
            <button onclick="addPost()">Add Post</button>
        </section>

        <!-- Blog Posts -->
        <section id="posts">
        </section>
    </main>

    <script>
        const API = 'http://localhost:3000';

        async function getComments() {
            try {
                const res = await fetch(`${API}/get-comments`);
                const data = await res.json();
                displayComments(data.reverse());
            } catch (error) {
                alert("Failed to load comments.");
            }
        }

        function displayComments(comments) {
            const container = document.getElementById('posts');
            container.innerHTML = comments.map(c => `
                <div class="post">
                <div class="meta"><strong>${c.name}</strong> â€” ${new Date(c.timestamp).toLocaleString()}</div>
                <p>${c.body}</p>
                <button onclick="deleteComment(${c.id})">Delete</button>
                </div>
            `).join('');
        }


// voeg try catch toe
        async function addPost() {
            const name = document.getElementById('Name').value.trim();
            const text = document.getElementById('Text').value.trim();

            if (!name || !text) return alert("Please fill in both fields.");

            const res = await fetch(`${API}/insert-comment`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, text })
            });

            if (!res.ok) {
                return alert('Server error when posting comment.');
            }

            document.getElementById('Name').value = '';
            document.getElementById('Text').value = '';
            getComments();
        }

        async function deleteComment(id) {
            await fetch(`${API}/delete-comments/${id}`, { method: 'DELETE' });
            fetchComments();
        }

        getComments();
    </script>
</body>

</html>